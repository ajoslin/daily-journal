"use strict";!function(){var e,r;angular.module("firebase",[]).value("Firebase",Firebase),angular.module("firebase").factory("$firebase",["$q","$parse","$timeout",function(r,t,n){return function(i){var o=new e(r,t,n,i);return o.construct()}}]),angular.module("firebase").filter("orderByPriority",function(){return function(e){var r=[];if(e)if(e.$getIndex&&"function"==typeof e.$getIndex){var t=e.$getIndex();if(t.length>0)for(var n=0;n<t.length;n++){var i=e[t[n]];i&&(i.$id=t[n],r.push(i))}}else angular.isArray(e)?r=e.slice(0):angular.isObject(e)&&angular.forEach(e,function(e){r.push(e)});return r}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,r){if(void 0===this||null===this)throw new TypeError("'this' is null or not defined");var t=this.length>>>0;for(r=+r||0,1/0===Math.abs(r)&&(r=0),0>r&&(r+=t,0>r&&(r=0));t>r;r++)if(this[r]===e)return r;return-1}),e=function(e,r,t,n){if(this._q=e,this._parse=r,this._timeout=t,this._bound=!1,this._loaded=!1,this._index=[],this._on={value:[],change:[],loaded:[],child_added:[],child_moved:[],child_changed:[],child_removed:[]},"string"==typeof n)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=n},e.prototype={construct:function(){var r=this,t={};return t.$id=r._fRef.ref().name(),t.$bind=function(e,t,n){return r._bind(e,t,n)},t.$add=function(e){function t(e){e?i.reject(e):i.resolve(n)}var n,i=r._q.defer();return n="object"==typeof e?r._fRef.ref().push(r._parseObject(e),t):r._fRef.ref().push(e,t),i.promise},t.$save=function(e){function t(e){e?n.reject(e):n.resolve()}var n=r._q.defer();if(e){var i=r._parseObject(r._object[e]);r._fRef.ref().child(e).set(i,t)}else r._fRef.ref().set(r._parseObject(r._object),t);return n.promise},t.$set=function(e){var t=r._q.defer();return r._fRef.ref().set(r._parseObject(e),function(e){e?t.reject(e):t.resolve()}),t.promise},t.$update=function(e){var t=r._q.defer();return r._fRef.ref().update(r._parseObject(e),function(e){e?t.reject(e):t.resolve()}),t.promise},t.$transaction=function(e,t){var n=r._q.defer();return r._fRef.ref().transaction(e,function(e,r,t){e?n.reject(e):n.resolve(r?t:null)},t),n.promise},t.$remove=function(e){function t(e){e?n.reject(e):n.resolve()}var n=r._q.defer();return e?r._fRef.ref().child(e).remove(t):r._fRef.ref().remove(t),n.promise},t.$child=function(t){var n=new e(r._q,r._parse,r._timeout,r._fRef.ref().child(t));return n.construct()},t.$on=function(e,n){if(!r._on.hasOwnProperty(e))throw new Error("Invalid event type "+e+" specified");return r._sendInitEvent(e,n),"loaded"===e&&this._loaded||r._on[e].push(n),t},t.$off=function(e,t){if(r._on.hasOwnProperty(e))if(t){var n=r._on[e].indexOf(t);-1!==n&&r._on[e].splice(n,1)}else r._on[e]=[];else r._fRef.off()},t.$auth=function(e){var t=r._q.defer();return r._fRef.auth(e,function(e,r){null!==e?t.reject(e):t.resolve(r)},function(e){t.reject(e)}),t.promise},t.$getIndex=function(){return angular.copy(r._index)},t.$getRef=function(){return r._fRef.ref()},r._object=t,r._getInitialValue(),r._object},_getInitialValue:function(){function e(e,r){var t=e.name(),i=e.val(),o=a._index.indexOf(t);if(-1!==o&&a._index.splice(o,1),r){var s=a._index.indexOf(r);a._index.splice(s+1,0,t)}else a._index.unshift(t);n(i)||null===e.getPriority()||(i.$priority=e.getPriority()),a._updateModel(t,i)}function r(e,r){return function(t,n){r(t,n),a._broadcastEvent(e,a._makeEventSnapshot(t.name(),t.val(),n))}}function t(e,t){a._fRef.on(e,r(e,t))}function n(e){return null===e||"object"!=typeof e}function i(e){a._loaded=!0,a._broadcastEvent("loaded",e)}function o(e){if(a._bound&&null===e){var r=a._parseObject(a._parse(a._name)(a._scope));switch(typeof r){case"string":case"undefined":e="";break;case"number":e=0;break;case"boolean":e=!1}}return e}var a=this;t("child_added",e),t("child_moved",e),t("child_changed",e),t("child_removed",function(e){var r=e.name(),t=a._index.indexOf(r);a._index.splice(t,1),a._updateModel(r,null)}),a._fRef.on("value",function(e){var r=e.val();n(r)?(r=o(r),a._updatePrimitive(r)):delete a._object.$value,a._broadcastEvent("value",a._makeEventSnapshot(e.name(),r)),a._loaded||i(r)})},_updateModel:function(e,r){null==r?delete this._object[e]:this._object[e]=r,this._broadcastEvent("change",e),this._triggerModelUpdate()},_triggerModelUpdate:function(){if(!this._runningTimer){var e=this;this._runningTimer=e._timeout(function(){if(e._runningTimer=null,e._bound){var r=e._object,t=e._parse(e._name)(e._scope);angular.equals(r,t)||e._parse(e._name).assign(e._scope,angular.copy(r))}})}},_updatePrimitive:function(e){var r=this;r._timeout(function(){if(r._object.$value&&angular.equals(r._object.$value,e)||(r._object.$value=e),r._broadcastEvent("change"),r._bound){var t=r._parseObject(r._parse(r._name)(r._scope));angular.equals(t,e)||r._parse(r._name).assign(r._scope,e)}})},_broadcastEvent:function(e,r){function t(e,r){i._timeout(function(){e(r)})}var n=this._on[e]||[];"loaded"===e&&(this._on[e]=[]);var i=this;if(n.length>0)for(var o=0;o<n.length;o++)"function"==typeof n[o]&&t(n[o],r)},_sendInitEvent:function(e,r){var t=this;t._loaded&&["child_added","loaded","value"].indexOf(e)>-1&&t._timeout(function(){var n=angular.isObject(t._object)?t._parseObject(t._object):t._object;switch(e){case"loaded":r(n);break;case"value":r(t._makeEventSnapshot(t._fRef.name(),n,null));break;case"child_added":t._iterateChildren(n,function(e,n,i){r(t._makeEventSnapshot(e,n,i))})}})},_iterateChildren:function(e,r){if(this._loaded&&angular.isObject(e)){var t=null;for(var n in e)e.hasOwnProperty(n)&&(r(n,e[n],t),t=n)}},_makeEventSnapshot:function(e,r,t){return angular.isUndefined(t)&&(t=null),{snapshot:{name:e,value:r},prevChild:t}},_bind:function(e,r,t){var n=this,i=n._q.defer();n._name=r,n._bound=!0,n._scope=e;var o=n._parse(r)(e);void 0!==o&&"object"==typeof o&&n._fRef.ref().update(n._parseObject(o));var a=e.$watch(r,function(){var t=n._parseObject(n._parse(r)(e));void 0!==n._object.$value&&angular.equals(t,n._object.$value)||angular.equals(t,n._parseObject(n._object))||void 0!==t&&n._loaded&&(n._fRef.set?n._fRef.set(t):n._fRef.ref().update(t))},!0);return e.$on("$destroy",function(){a()}),n._fRef.once("value",function(o){n._timeout(function(){"object"!=typeof o.val()?(null==o.val()&&"function"==typeof t&&(e[r]=t()),i.resolve(a)):n._timeout(function(){null==o.val()&&"function"==typeof t&&(e[r]=t()),i.resolve(a)})})}),i.promise},_parseObject:function(e){function r(e){for(var t in e)e.hasOwnProperty(t)&&("$priority"==t?(e[".priority"]=e.$priority,delete e.$priority):"object"==typeof e[t]&&r(e[t]));return e}var t=r(angular.copy(e));return angular.fromJson(angular.toJson(t))}},angular.module("firebase").factory("$firebaseSimpleLogin",["$q","$timeout","$rootScope",function(e,t,n){return function(i){var o=new r(e,t,n,i);return o.construct()}}]),r=function(e,r,t,n){if(this._q=e,this._timeout=r,this._rootScope=t,this._loginDeferred=null,this._getCurrentUserDeferred=[],this._currentUserData=void 0,"string"==typeof n)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=n},r.prototype={construct:function(){var e={user:null,$login:this.login.bind(this),$logout:this.logout.bind(this),$createUser:this.createUser.bind(this),$changePassword:this.changePassword.bind(this),$removeUser:this.removeUser.bind(this),$getCurrentUser:this.getCurrentUser.bind(this),$sendPasswordResetEmail:this.sendPasswordResetEmail.bind(this)};if(this._object=e,!window.FirebaseSimpleLogin){var r=new Error("FirebaseSimpleLogin is undefined. Did you forget to include firebase-simple-login.js?");throw this._rootScope.$broadcast("$firebaseSimpleLogin:error",r),r}var t=new FirebaseSimpleLogin(this._fRef,this._onLoginEvent.bind(this));return this._authClient=t,this._object},login:function(e,r){var t=this._q.defer(),n=this;return this.getCurrentUser().then(function(){n._loginDeferred=t,n._authClient.login(e,r)}),t.promise},logout:function(){this._authClient.logout(),delete this._currentUserData},createUser:function(e,r){var t=this,n=this._q.defer();return t._authClient.createUser(e,r,function(e,r){e?(t._rootScope.$broadcast("$firebaseSimpleLogin:error",e),n.reject(e)):n.resolve(r)}),n.promise},changePassword:function(e,r,t){var n=this,i=this._q.defer();return n._authClient.changePassword(e,r,t,function(e){e?(n._rootScope.$broadcast("$firebaseSimpleLogin:error",e),i.reject(e)):i.resolve()}),i.promise},getCurrentUser:function(){var e=this,r=this._q.defer();return void 0!==e._currentUserData?r.resolve(e._currentUserData):e._getCurrentUserDeferred.push(r),r.promise},removeUser:function(e,r){var t=this,n=this._q.defer();return t._authClient.removeUser(e,r,function(e){e?(t._rootScope.$broadcast("$firebaseSimpleLogin:error",e),n.reject(e)):n.resolve()}),n.promise},sendPasswordResetEmail:function(e){var r=this,t=this._q.defer();return r._authClient.sendPasswordResetEmail(e,function(e){e?(r._rootScope.$broadcast("$firebaseSimpleLogin:error",e),t.reject(e)):t.resolve()}),t.promise},_onLoginEvent:function(e,r){if(this._currentUserData!==r||null!==e){var t=this;e?(t._loginDeferred&&(t._loginDeferred.reject(e),t._loginDeferred=null),t._rootScope.$broadcast("$firebaseSimpleLogin:error",e)):(this._currentUserData=r,t._timeout(function(){for(t._object.user=r,r?t._rootScope.$broadcast("$firebaseSimpleLogin:login",r):t._rootScope.$broadcast("$firebaseSimpleLogin:logout"),t._loginDeferred&&(t._loginDeferred.resolve(r),t._loginDeferred=null);t._getCurrentUserDeferred.length>0;){var e=t._getCurrentUserDeferred.pop();e.resolve(r)}}))}}}}();